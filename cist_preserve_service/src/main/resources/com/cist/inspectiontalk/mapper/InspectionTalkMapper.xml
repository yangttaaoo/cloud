<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cist.inspectiontalk.mapper.InspectionTalkMapper" >
	<select id="instalkpageList" resultType="com.cist.inspectiontalk.model.TalkInfo" parameterType="java.util.HashMap">
   		select o.pk_id as gspk,o.COMPANY_CONFIRM,o.FK_RAPPORTEUR_ID,to_char(o.REPORT_TIME,'yyyy-mm-dd HH24:mi:ss')as REPORT_TIME,o.INSPECTION_REPORT,h.*,to_char(h.inspection_start_time,'yyyy-mm-dd HH24:mi:ss')as start_time,to_char(h.inspection_end_time,'yyyy-mm-dd HH24:mi:ss')as end_time from(select l.* from
(select t.* from JTYW_MAINTENANCE_STAFF t,JTYW_MAINTENANCE_COMPANY j where t.fk_comp_id = j.pk_id and t.pk_id=#{pk_id}) k,
JTYW_INSPECTION_COMPANY_LIST l where k.fk_comp_id = l.fk_company_id) o,
JTYW_INSPECTION_PLAN h  
    		<where>
	   			o.inspection_num = h.pk_id and h.check_status = 1
	    		<if test="xjmc !=null and xjmc !=''">
	    		and h.INSPECTION_NAME like '%'||#{xjmc}||'%'
	    		</if>
	    		<if test="kssj!=null and kssj!=''">
		    	<![CDATA[and h.INSPECTION_START_TIME >=to_date(#{kssj},'yyyy-mm-dd HH24:mi:ss')]]>
	        	</if>
	       	 	<if test="jssj!=null and jssj!=''">
		    	<![CDATA[and h.INSPECTION_END_TIME <=to_date(#{jssj},'yyyy-mm-dd HH24:mi:ss')]]>
	        	</if>
	    	</where>
   </select>
   
   <update id="talkqr"  parameterType="java.util.HashMap">
       UPDATE JTYW_INSPECTION_COMPANY_LIST SET 
             COMPANY_CONFIRM=1,
             COMPANY_CONFIRM_TIME=sysdate
       where pk_id = #{pk_id}
     </update>
     
     <update id="talking"  parameterType="java.util.HashMap">
       UPDATE JTYW_INSPECTION_COMPANY_LIST SET 
             FK_RAPPORTEUR_ID=#{bgr},
             REPORT_TIME=sysdate,
             INSPECTION_REPORT=#{xjbg}
       where pk_id = #{pk_id}
     </update>
   
    <select id="quebgr" resultType="java.lang.String" parameterType="java.lang.Integer">
   		select t.staff_name from JTYW_MAINTENANCE_STAFF t where pk_id=#{_parameter}
   </select>
</mapper>