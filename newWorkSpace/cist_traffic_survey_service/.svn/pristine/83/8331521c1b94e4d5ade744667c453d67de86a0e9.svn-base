<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cist.securityfacility.mapper.SecurityFacilityMapper">
	<!-- 根据条件查询安防设施信息 -->
	<select id="querySecurityFacility" parameterType="java.util.HashMap"
	resultType="com.cist.securityfacility.model.Jcsj_sps_facilities">
		select t.*,(select b.dept_name from SYS_DEPART_INFO b where b.dept_code=t.glbm) glbm_name,
(select fc_name from sys_frm_code where fct_code='AFSS' and fc_code=t.afsslx) afsslx_name,
(select tbek_name from C_KREIS_CODE where tbek_code=t.xzqh) xzqh_name,
(select r.roim_name from C_ROAD_ITEM r where  r.dept_code=t.glbm and r.roim_code = to_char(t.dldm)) dldm_name from Jcsj_sps_facilities t
		<where>
			<if test="glbm !=null and glbm !=''">
				and glbm = #{glbm}
			</if>
			<if test="dldm !=null and dldm !=''">
				and dldm = #{dldm}
			</if>
			<if test="xzqh !=null and xzqh !=''">
				and xzqh = #{xzqh}
			</if>
			<if test="afsslx !=null and afsslx !=''">
				and afsslx = #{afsslx}
			</if>
			<if test="jsdw !=null and jsdw !=''">
				and jsdw like '%'||#{jsdw}||'%'
			</if>
			<if test="sgdw !=null and sgdw !=''">
				and sgdw like '%'||#{sgdw}||'%'
			</if>
			<if test="kssj!=null and kssj!=''">
				<![CDATA[ and syqxjzsj >=to_date(#{kssj},'yyyy-mm-dd HH24:mi:ss')]]>
			</if>
			<if test="jssj!=null and jssj!=''">
				<![CDATA[and syqxjzsj <= to_date(#{jssj},'yyyy-mm-dd HH24:mi:ss') ]]>
			</if>
		</where>
	</select>
	<!--  新增安防设施信息    -->
	<insert id="insertSecurityFacility" parameterType="java.util.Map">
		insert into Jcsj_sps_facilities
		<trim prefix="(" suffixOverrides="," suffix=")">
			pk_id,
			glbm,
			<if test="xzqh !=null and xzqh !=''">
				xzqh,
			</if>
			dldm,
			dllx,
			lddm,
			dlms,
			dllxmc,
			<if test="jdzb !=null and jdzb !=''">
				jdzb,
			</if>
			<if test="wdzb !=null and wdzb !=''">
				wdzb,
			</if>
			<if test="jyms !=null and jyms !=''">
				jyms,
			</if>
			<if test="afsscd !=null and afsscd !=''">
				afsscd,
			</if>
			<if test="afssgd !=null and afssgd !=''">
				afssgd,
			</if>
			<if test="jsdw !=null and jsdw !=''">
				jsdw,
			</if>
			<if test="sgdw !=null and sgdw !=''">
				sgdw,
			</if>
			<if test="jssj !=null and jssj !=''">
				jssj,
			</if>
			<if test="syqxjzsj !=null and syqxjzsj !=''">
				syqxjzsj,
			</if>
			<if test="syqxy !=null and syqxy !=''">
				syqxy,
			</if>
			<if test="syqxm !=null and syqxm !=''">
				syqxm,
			</if>
			<if test="afsssjtp !=null and afsssjtp !=''">
				afsssjtp,
			</if>
			afsslx,
		</trim>
		<trim prefix="values(" suffixOverrides="," suffix=")">
			SEQ_JCSJ_SAD_INFO_PK.nextval,
			#{glbm},
			<if test="xzqh !=null and xzqh !=''">
				#{xzqh},
			</if>
			#{dldm},
			#{dllx},
			#{lddm},
			#{dlms},
			#{dllxmc},
			<if test="jdzb !=null and jdzb !=''">
				#{jdzb},
			</if>
			<if test="wdzb !=null and wdzb !=''">
				#{wdzb},
			</if>
			<if test="jyms !=null and jyms !=''">
				#{jyms},
			</if>
			<if test="afsscd !=null and afsscd !=''">
				#{afsscd},
			</if>
			<if test="afssgd !=null and afssgd !=''">
				#{afssgd},
			</if>
			<if test="jsdw !=null and jsdw !=''">
				#{jsdw},
			</if>
			<if test="sgdw !=null and sgdw !=''">
				#{sgdw},
			</if>
			<if test="jssj !=null and jssj !=''">
				to_date(#{jssj},'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="syqxjzsj !=null and syqxjzsj !=''">
				to_date(#{syqxjzsj},'yyyy-mm-dd HH24:mi:ss'),
			</if>
			<if test="syqxy !=null and syqxy !=''">
				#{syqxy},
			</if>
			<if test="syqxm !=null and syqxm !=''">
				#{syqxm},
			</if>
			<if test="afsssjtp !=null and afsssjtp !=''">
				#{afsssjtp},
			</if>
			#{afsslx},
		</trim>
	</insert>
	<!-- 更新设施信息 -->
	<update id="updateSecurityFacility" parameterType="java.util.Map">
		update Jcsj_sps_facilities T 
			<trim prefix="set" suffixOverrides=",">
				<if test="glbm !=null and glbm !=''">
					glbm=#{glbm},
				</if>
				<if test="xzqh !=null and xzqh !=''">
				xzqh=#{xzqh},
				</if>
				<if test="dldm !=null and dldm !=''">
				dldm=#{dldm},
				</if>
				<if test="dllx !=null and dllx !=''">
				dllx=#{dllx},
				</if>
				<if test="lddm !=null and lddm !=''">
				lddm=#{lddm},
				</if>
				<if test="dlms !=null and dlms !=''">
				dlms=#{dlms},
				</if>
				<if test="dllxmc !=null and dllxmc !=''">
				dllxmc=#{dllxmc},
				</if>
				<if test="jdzb !=null and jdzb !=''">
				jdzb=#{jdzb},
				</if>
				<if test="wdzb !=null and wdzb !=''">
				wdzb=#{wdzb},
				</if>
				<if test="jyms !=null and jyms !=''">
				jyms=#{jyms},
				</if>
				<if test="afsslx !=null and afsslx !=''">
				afsslx=#{afsslx},
				</if>
				<if test="afsscd !=null and afsscd !=''">
				afsscd=#{afsscd},
				</if>
				<if test="afssgd !=null and afssgd !=''">
				afssgd=#{afssgd},
				</if>
				<if test="jsdw !=null and jsdw !=''">
				jsdw=#{jsdw},
				</if>
				<if test="sgdw !=null and sgdw !=''">
				sgdw=#{sgdw},
				</if>
				<if test="jssj !=null and jssj !=''">
				jssj=to_date(#{jssj},'yyyy-mm-dd HH24:mi:ss'),
				</if>
				<if test="syqxjzsj !=null and syqxjzsj !=''">
				syqxjzsj=to_date(#{syqxjzsj},'yyyy-mm-dd HH24:mi:ss'),
				</if>
				<if test="syqxy !=null and syqxy !=''">
				syqxy=#{syqxy},
				</if>
				<if test="syqxm !=null and syqxm !=''">
				syqxm=#{syqxm},
				</if>
				<if test="afsssjtp !=null and afsssjtp !=''">
				afsssjtp=#{afsssjtp},
				</if>
			</trim>
		where pk_id=#{pk_id}
	</update>
	<!-- 单条/批量删除安防设施信息 -->
	<delete id="delSecurityFacility" parameterType="java.util.HashMap">
		delete from Jcsj_sps_facilities where pk_id in
		<foreach item="w" collection="list" open="(" separator="," close=")">
		       #{w}
		 </foreach> 
	</delete>
	<!-- 查询基础数据 -->
	<select id="querySys_frm_code" parameterType="java.util.HashMap"
	resultType="com.cist.securityfacility.model.Sys_frm_code">
		select * from sys_frm_code t 
		<where>
			<if test="fct_code != null and fct_code != ''">
				and fct_code = #{fct_code}
			</if>
		</where>
	</select>
</mapper>
	