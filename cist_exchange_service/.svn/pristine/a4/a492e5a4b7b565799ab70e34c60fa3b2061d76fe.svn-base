<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cist.empowerquery.mapper.empowerqueryMapper" >
 
  <select id="list" resultType="com.cist.interfaceapply.model.SjgxInterfaceUseApply" parameterType="java.util.HashMap" >
   select t.* ,t2.dev_name dev_company_name,t2.interface_id interface_id_str,t2.dev_company_id dev_company_id_str
    from SJGX_INTERFACE_USE_APPLY t
    right join (select t1.fk_use_apply_id fk_use_apply_id, listagg(t1.dev_company_name,'„ÄÅ') within group(order by t1.dev_company_name)dev_name
    ,listagg(t1.interface_id,',') within group(order by t1.interface_id)interface_id
    ,listagg(t1.dev_company_id,',') within group(order by t1.dev_company_id)dev_company_id
    from cistsys.sjgx_interface_list t1 
    where t1.fk_use_apply_id is not null
    <if test="dev_company_id !=null and dev_company_id !=''">
	and t1.dev_company_id =#{dev_company_id}
	</if> 
	 group by t1.fk_use_apply_id)t2
    on t.pk_id=t2.fk_use_apply_id
    <where>
	<if test="fk_used_id !=null and fk_used_id !='' and fk_used_id !='null'">
		and fk_used_id=#{fk_used_id}
	</if>
	<if test="apply_date !=null and apply_date !='' and apply_date !='null'">
      <![CDATA[ and apply_date <=to_date(#{apply_date},'yyyy-mm-dd HH24:mi:ss')]]>
	</if> 
	and check_status ='1'
    </where>
  </select>
</mapper>