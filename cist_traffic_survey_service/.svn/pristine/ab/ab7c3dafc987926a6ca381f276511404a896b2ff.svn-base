<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.cist.policemngment.mapper.PoliceMngmentMapper">


	<select id="selectByResourc"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc"
		parameterType="java.util.Map">
		select * from jcsj_police_resources t

		<where>
			<if test="fk_dept_id != null and fk_dept_id !=''">
				and t.fk_dept_id =#{fk_dept_id}
			</if>


			<if test="resources_type != null and resources_type !=''">
				and t.resources_type =#{resources_type}
			</if>

			<if test="device_type != null and device_type !=''">
				and t.device_type =#{device_type}
			</if>

			<if test="sim_num != null and sim_num !=''">
				and t.sim_num =#{sim_num}
			</if>

			<if test="call_num != null and call_num !=''">
				and t.call_num =#{call_num}
			</if>
			<if test="car_brand != null and car_brand !=''">
				and trim(t.car_brand)=#{car_brand}
			</if>
			<if test="car_num != null and car_num !=''">
				and lower(t.car_num) like lower('%'||#{car_num}||'%')

			</if>


			<if test="device_code != null and device_code !=''">
				and t.device_code =#{device_code}
			</if>
			<if test="car_purpose != null and car_purpose !=''">
				and t.car_purpose =#{car_purpose}
			</if>

		</where>

	</select>

	<select id="selectByGps"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc"
		parameterType="java.util.Map">
		select * from jcsj_police_resources t
		<where>
			<if test="fk_dept_id != null and fk_dept_id !=''">
				and t.fk_dept_id =#{fk_dept_id}
			</if>


			<if test="resources_type != null and resources_type !=''">
				and t.resources_type =#{resources_type}
			</if>

			<if test="device_type != null and device_type !=''">
				and t.device_type =#{device_type}
			</if>

			<if test="sim_num != null and sim_num !=''">
				and t.sim_num =#{sim_num}
			</if>

			<if test="call_num != null and call_num !=''">
				and t.call_num =#{call_num}
			</if>
			<if test="car_brand != null and car_brand !=''">
				and t.car_brand =#{car_brand}
			</if>
			<if test="car_num != null and car_num !=''">
				and lower(t.car_num) like lower('%'||#{car_num}||'%')

			</if>


			<if test="device_code != null and device_code !=''">
				and t.device_code=#{device_code}
			</if>
		</where>

	</select>

	<!-- 过期数据条件查询 -->
	<select id="selectByResourcs"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc"
		parameterType="java.util.Map">
		select * from jcsj_police_resources t
		<where>

			<if test="resources_type == null or resources_type =='' ">
				and t.resources_type=1 or resources_type=5
			</if>
			<if test="resources_type != null and resources_type !='' ">
				and t.resources_type=#{resources_type}
			</if>
			<if test="overdue==4 and overdue!='' and overdue != null">
				and t.annual_inspection_valid > sysdate
			</if>
			<if test="overdue==5 and overdue!='' and overdue != null">
			 <![CDATA[ and t.annual_inspection_valid <= sysdate ]]>
			</if>


			<if test="overdue1==1 and overdue1!=null and overdue1!= ''">
			<![CDATA[  and t.annual_inspection_valid > sysdate-30  and  t.annual_inspection_valid < sysdate ]]>
			</if>
			<if test="overdue1==2 and overdue1!=null and overdue1!= ''">
			<![CDATA[  and t.annual_inspection_valid > sysdate-60  and  t.annual_inspection_valid < sysdate-30 ]]>
			</if>
			<if test="overdue1==3 and overdue1!=null and overdue1!= ''">
			<![CDATA[ and t.annual_inspection_valid > sysdate-90  and  t.annual_inspection_valid < sysdate-60 ]]>
			</if>
		</where>

	</select>

	<select id="selectByPolice"
		resultType="com.cist.policemngment.model.Jcsj_Police_Res_Person"
		parameterType="java.util.Map">

		select * from jcsj_police_res_person t

		<where>

			<if test="ryfl != null and ryfl !=''">
				and t.ryfl=#{ryfl}
			</if>

			<if test="rybh != null and rybh !=''">
				and t.rybh like '%'||#{rybh}||'%'
			</if>

			<if test="glbm != null and glbm !=''">
				and t.glbm=#{glbm}
			</if>

			<if test="xm != null and xm !=''">
				and t.xm like '%'||#{xm}||'%'
			</if>
			<if test="zt != null and zt !=''">
				and t.zt=#{zt}
			</if>

		</where>

	</select>


	<select id="depart_infolist"
		resultType="com.cist.policemngment.model.DeptInfo"
		parameterType="java.lang.Integer">
		select t.dept_pk,t.dept_code,t.dept_name as name,t.DEPT_SUPERIOR from
		sys_depart_info t
		<where>
			<if test="_parameter  == null or _parameter  == ''">
				t.DEPT_SUPERIOR is null
			</if>
			<if test="_parameter  != null and _parameter  != ''">
				t.DEPT_SUPERIOR=#{_parameter}
			</if>
		</where>
	</select>

	<select id="depart_infolists"
		resultType="com.cist.policemngment.model.Depart_info"
		parameterType="java.lang.Integer">
		select t.fk_dept_id
		dept_code,t.resources_type,listagg(t.car_num,',')within group(order by
		t.car_num)car_num from JCSJ_POLICE_RESOURCES t
		where t.resources_type
		in(1,5,6) group by t.fk_dept_id,t.resources_type
	</select>




	<select id="depart_infolistss"
		resultType="com.cist.policemngment.model.Depart_info"
		parameterType="java.lang.Integer">
		select t.fk_dept_id
		dept_code,listagg(t.device_type,',')within group(order
		by
		t.device_type) device_type from JCSJ_POLICE_RESOURCES t
		where
		t.resources_type in(2,3,4) group by t.fk_dept_id
	</select>


	<!-- 查询部门下的人员 -->
	<select id="selectPolice"
		resultType="com.cist.policemngment.model.Jcsj_Police_Res_Person">
		select t.* from
		JCSJ_POLICE_RES_PERSON t


		where GLBM=#{glbm}

		<!--查询未关联设备的数据 -->
		<if test="flag != null and flag!='' ">
			and  NOT EXISTS
			(select fk_user_id from jcsj_p_r_allot t1
			 left join JCSJ_POLICE_RESOURCES t2 on t2.pk_id = t1.fk_p_r_id where t2.RESOURCES_TYPE=#{resources_type} and t.id=t1.fk_user_id )
			<!-- (select fk_user_id from jcsj_p_r_allot t1
			 left join JCSJ_POLICE_RESOURCES t2 on t2.pk_id = t1.fk_p_r_id where t2.RESOURCES_TYPE=#{resources_type}) -->
		</if>
	</select>

	<!-- 查询选择的人员是否关联信息 -->
	<select id="selectPoliceByCheck"
		resultType="com.cist.policemngment.model.Jcsj_P_R_Allot">
		select * from jcsj_p_r_allot t 
        left join JCSJ_POLICE_RESOURCES t1 on t1.pk_id = t.fk_p_r_id 
        where t1.RESOURCES_TYPE=#{resources_type}
        and 
		t.fk_p_r_id != #{fk_p_r_id}
		and
		t.fk_user_id in

		<foreach item="pk" collection="array" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</select>

	<select id="selectCarGPS"
		resultType="com.cist.policemngment.model.Jcsj_P_R_Relation">
		select * from
		jcsj_p_r_relation t
	</select>

	<select id="selectHave"
		resultType="com.cist.policemngment.model.Jcsj_P_R_Have">
		select fk_have_function from
		jcsj_p_r_have_function t where
		fk_p_r_id=#{fk_p_r_id}
	</select>

	<select id="selectPoliceCheck"
		resultType="com.cist.policemngment.model.Jcsj_Police_Res_Person">
		select t1.id,t1.xm,t1.glbm from jcsj_p_r_allot t left join
		Jcsj_Police_Res_Person t1 on t.fk_user_id=t1.id

		where
		t.fk_p_r_id=#{fk_p_r_id}
	</select>

	<select id="selectSysFrmCode"
		resultType="com.cist.policemngment.model.Sys_frm_code"
		parameterType="java.lang.String">
		select * from SYS_FRM_CODE
		where
		FCT_CODE=#{fct_code}
	</select>

	<insert id="insertPolicePerson" parameterType="java.util.Map">
		insert into JCSJ_POLICE_RES_PERSON
		<trim prefix="(" suffix=")" suffixOverrides=",">

			id,
			glbm,
			rybh,
			xm,
			xb,
			<if test="ywgw != null and ywgw !='' and ywgw != 'null'">
				ywgw,
			</if>
			zt,
			<if test="bgdh != null and bgdh !='' and bgdh != 'null'">
				bgdh,
			</if>
			<if test="yddh != null and yddh !='' and yddh != 'null'">
				yddh,
			</if>
			<if test="dth != null and dth !='' and dth != 'null'">
				dth,
			</if>
			<if test="zhh != null and zhh !='' and zhh != 'null'">
				zhh,
			</if>
			<if test="vwh != null and vwh !='' and vwh != 'null'">
				vwh,
			</if>
			sfzhm,
			ryfl,
			<if test="fjlx != null and fjlx !='' and fjlx != 'null'">
				fjlx,
			</if>
			<if test="bzlx != null and bzlx !=''">
				bzlx,
			</if>
			<if test="zw != null and zw !=''">
				zw,
			</if>
			<if test="zj != null and zj !=''">
				zj,
			</if>
			<if test="csrq != null and csrq !=''">
				csrq,
			</if>
			<if test="mz != null and mz !=''">
				mz,
			</if>
			<if test="hyzk != null and hyzk !=''">
				hyzk,
			</if>
			<if test="jg != null and jg !=''">
				jg,
			</if>
			<if test="hjszd != null and hjszd !=''">
				hjszd,
			</if>
			<if test="zzmm != null and zzmm !=''">
				zzmm,
			</if>
			<if test="grsf != null and grsf !=''">
				grsf,
			</if>
			<if test="cjgzrq != null and cjgzrq !=''">
				cjgzrq,
			</if>
			<if test="rdtrq != null and rdtrq !=''">
				rdtrq,
			</if>
			<if test="pic != null and pic !=''">
				pic,
			</if>
			<if test="sbh != null and sbh !='' and sbh !='null'">
				sbh,
			</if>

		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			cistsys.SEQ_STICK_MAG.nextval,
			#{glbm},
			#{rybh},
			#{xm},
			#{xb},
			<if test="ywgw != null and ywgw !='' and ywgw != 'null'">
				#{ywgw},
			</if>
			#{zt},
			<if test="bgdh != null and bgdh !='' and bgdh != 'null'">
				#{bgdh},
			</if>
			<if test="yddh != null and yddh !='' and yddh != 'null'">
				#{yddh},
			</if>
			<if test="dth != null and dth !='' and dth != 'null'">
				#{dth},
			</if>
			<if test="zhh != null and zhh !='' and zhh != 'null'">
				#{zhh},
			</if>
			<if test="vwh != null and vwh !='' and vwh != 'null'">
				#{vwh},
			</if>
			#{sfzhm},
			#{ryfl},
			<if test="fjlx != null and fjlx !=''">
				#{fjlx},
			</if>
			<if test="bzlx != null and bzlx !=''">
				#{bzlx},
			</if>
			<if test="zw != null and zw !=''">
				#{zw},
			</if>
			<if test="zj != null and zj !=''">
				#{zj},
			</if>
			<if test="csrq != null and csrq !=''">
				to_date(#{csrq},'yyyy-mm-dd'),
			</if>
			<if test="mz != null and mz !=''">
				#{mz},
			</if>
			<if test="hyzk != null and hyzk !=''">
				#{hyzk},
			</if>
			<if test="jg != null and jg !=''">
				#{jg},
			</if>
			<if test="hjszd != null and hjszd !=''">
				#{hjszd},
			</if>
			<if test="zzmm != null and zzmm !=''">
				#{zzmm},
			</if>
			<if test="grsf != null and grsf !=''">
				#{grsf},
			</if>
			<if test="cjgzrq != null and cjgzrq !=''">
				to_date(#{cjgzrq},'yyyy-mm-dd'),
			</if>
			<if test="rdtrq != null and rdtrq !=''">
				to_date(#{rdtrq},'yyyy-mm-dd'),

			</if>
			<if test="pic != null and pic !=''">
				#{pic},
			</if>
			<if test="sbh != null and sbh !='' and sbh !='null'">
				#{sbh},
			</if>
		</trim>
	</insert>
	<update id="updatePolicePerson" parameterType="java.util.Map">
		update JCSJ_POLICE_RES_PERSON
		<trim prefix="set" suffixOverrides=",">
			<if test="glbm != null and glbm !=''">
				glbm = #{glbm},
			</if>
			<if test="rybh != null and rybh !=''">
				rybh = #{rybh},
			</if>

			<if test="xm != null and xm!='' and xm !='null'">
				xm = #{xm},
			</if>

			<if test="xb != null and xb !='' and xb !='null'">
				xb = #{xb},
			</if>

			<if test="ywgw != null and ywgw !='' and ywgw !='null'">
				ywgw = #{ywgw},
			</if>

			<if test="zt != null and zt !='' and zt !='null'">
				zt = #{zt},
			</if>

			<if test="sfzhm != null and sfzhm !='' and sfzhm !='null'">
				sfzhm = #{sfzhm},
			</if>

			<if test="ryfl != null and ryfl !=''">
				ryfl = #{ryfl},
			</if>

			<if test="fjlx != null and fjlx !=''">
				fjlx = #{fjlx},
			</if>


			<if test="bzlx != null and bzlx !=''">
				bzlx = #{bzlx},
			</if>


			<if test="zw != null and zw !=''">
				zw = #{zw},
			</if>
			<if test="zj != null and zj !=''">
				zj = #{zj},
			</if>
			<if test="csrq != null and csrq !=''">
				csrq = to_date(#{csrq},'yyyy-MM-dd'),
			</if>
			<if test="mz != null and mz !=''">
				mz = #{mz},
			</if>
			<if test="hyzk != null and hyzk !=''">
				hyzk = #{hyzk},
			</if>
			<if test="jg != null and jg !=''">
				jg = #{jg},
			</if>
			<if test="hjszd != null and hjszd !=''">
				hjszd = #{hjszd},
			</if>
			<if test="zzmm != null and zzmm !=''">
				zzmm = #{zzmm},
			</if>
			<if test="grsf != null and grsf !=''">
				grsf = #{grsf},
			</if>
			<if test="cjgzrq != null and cjgzrq !=''">
				cjgzrq = to_date(#{cjgzrq},'yyyy-MM-dd'),
			</if>
			<if test="rdtrq != null and rdtrq !=''">
				rdtrq = to_date(#{rdtrq},'yyyy-MM-dd'),
			</if>

			<if test="pic != null and pic !='' and pic !='null'">
				pic = #{pic},
			</if>
			<choose>
				<when test="sbh != null and sbh !='' and sbh !='null'">
					sbh = #{sbh},
				</when>
				<otherwise>
					sbh = #{sbh,jdbcType=NULL},
				</otherwise>
			</choose>
			<choose>
				<when test="bgdh != null and bgdh !='' and bgdh !='null'">
					bgdh = #{bgdh},
				</when>
				<otherwise>
					bgdh = #{bgdh,jdbcType=NULL},
				</otherwise>
			</choose>
			<choose>
				<when test="yddh != null and yddh !='' and yddh !='null'">
					yddh = #{yddh},
				</when>
				<otherwise>
					yddh = #{yddh,jdbcType=NULL},
				</otherwise>
			</choose>
			<choose>
				<when test="dth != null and dth !='' and dth !='null'">
					dth = #{dth},
				</when>
				<otherwise>
					dth = #{dth,jdbcType=NULL},
				</otherwise>
			</choose>
			<choose>
				<when test="zhh != null and zhh !='' and zhh !='null'">
					zhh = #{zhh},
				</when>
				<otherwise>
					zhh = #{zhh,jdbcType=NULL},
				</otherwise>
			</choose>
			<choose>
				<when test="vwh != null and vwh !='' and vwh !='null'">
					vwh = #{vwh},
				</when>
				<otherwise>
					vwh = #{vwh,jdbcType=NULL},
				</otherwise>
			</choose>
		</trim>
		where id = #{id,jdbcType=DECIMAL}
	</update>

	<insert id="insetResourc" parameterType="java.util.Map">
		<selectKey resultType="java.lang.Integer" order="BEFORE"
			keyProperty="fk_p_r_id">
			SELECT cistsys.SEQ_TXZ_PERMIT.nextval FROM DUAL
		</selectKey>
		insert into
		jcsj_police_resources
		<trim prefix="(" suffix=")" suffixOverrides=",">
			pk_id,
			fk_dept_id,
			enable_date,
			validity_date,
			create_person,
			create_time,
			resources_type,
			<if test="car_purpose != null and car_purpose !=''">
				car_purpose,
			</if>

			<if test="car_type != null and car_type !=''">
				car_type,
			</if>



			<if test="car_brand != null and car_brands !=''">
				car_brand,
			</if>



			<if test="car_num != null and car_num !=''">
				car_num,
			</if>


			<if
				test="annual_inspection_valid != null and annual_inspection_valid !=''">
				annual_inspection_valid,
			</if>


			<if test="insurance_company != null and insurance_company !=''">
				insurance_company,
			</if>

			<if test="insurance_num != null and insurance_num !=''">
				insurance_num,
			</if>

			<if test="manufacturer != null and manufacturer !=''">
				manufacturer,
			</if>

			<if test="sim_num != null and sim_num !=''">
				sim_num,
			</if>

			<if test="staff_name != null and staff_name !=''">
				staff_name,
			</if>

			<if test="staff_contacts_num != null and staff_contacts_num !=''">
				staff_contacts_num,
			</if>

			<if test="call_num != null and call_num !=''">
				call_num,
			</if>

			<if test="device_model != null and device_model !=''">
				device_model,
			</if>

			<if test="device_type != null and device_type !=''">
				device_type,
			</if>

			<if test="device_code != null and device_code !=''">
				device_code,
			</if>


		</trim>

		<trim prefix="values (" suffix=")" suffixOverrides=",">

			#{fk_p_r_id},
			#{fk_dept_id},
			to_date(#{enable_date},'yyyy-mm-dd'),
			to_date(#{validity_date},'yyyy-mm-dd'),

			#{create_person},
			sysdate,
			#{resources_type,jdbcType=VARCHAR},

			<if test="car_purpose != null and car_purpose !=''">
				#{car_purpose,jdbcType=VARCHAR},
			</if>

			<if test="car_type != null and car_type !=''">
				#{car_type,jdbcType=VARCHAR},
			</if>

			<if test="car_brand != null and car_brand !=''">
				#{car_brand,jdbcType=VARCHAR},
			</if>

			<if test="car_num != null and car_num !=''">
				#{car_num,jdbcType=VARCHAR},
			</if>



			<if
				test="annual_inspection_valid != null and annual_inspection_valid !=''">
				to_date(#{annual_inspection_valid},'yyyy-mm-dd'),
			</if>

			<if test="insurance_company != null and insurance_company !=''">
				#{insurance_company,jdbcType=VARCHAR},
			</if>



			<if test="insurance_num != null and insurance_num !=''">
				#{insurance_num,jdbcType=VARCHAR},
			</if>


			<if test="manufacturer != null and manufacturer !=''">
				#{manufacturer,jdbcType=VARCHAR},
			</if>



			<if test="sim_num != null and sim_num !=''">
				#{sim_num,jdbcType=VARCHAR},
			</if>


			<if test="staff_name != null and staff_name !=''">
				#{staff_name,jdbcType=VARCHAR},
			</if>


			<if test="staff_contacts_num != null and staff_contacts_num !=''">
				#{staff_contacts_num,jdbcType=VARCHAR},
			</if>


			<if test="call_num != null and call_num !=''">
				#{call_num,jdbcType=VARCHAR},
			</if>


			<if test="device_model != null and device_model !=''">
				#{device_model,jdbcType=VARCHAR},
			</if>


			<if test="device_type != null and device_type !=''">
				#{device_type,jdbcType=VARCHAR},
			</if>

			<if test="device_code != null and device_code !=''">
				#{device_code,jdbcType=VARCHAR},
			</if>
		</trim>

	</insert>



	<insert id="allotPolice" parameterType="java.util.Map">
		insert into jcsj_p_r_allot
		(
		fk_user_id,
		fk_p_r_id

		)
		SELECT cd.*
		FROM(
		<foreach item="item" index="index" collection="array"
			separator="union all">
			SELECT
			#{item},
			#{fk_p_r_id}
			FROM dual
		</foreach>
		)cd


	</insert>

	<!-- 警车关联GPS -->
	<insert id="allotPolicesss" parameterType="java.util.Map">
		insert into
		JCSJ_P_R_RELATION
		(
		fk_gps_id,
		fk_p_r_id

		)
		values(#{fk_gps_id},#{fk_p_r_id})
	</insert>

	<!-- GPS关联警车 -->
	<insert id="insertCarToGps" parameterType="java.util.Map">
		insert into
		JCSJ_P_R_RELATION
		(
		fk_gps_id,
		fk_p_r_id

		)
		values(#{fk_p_r_id},#{fk_car_id})
	</insert>


	<insert id="insertHave" parameterType="java.util.Map">
		insert into jcsj_p_r_have_function
		(
		fk_have_function,
		fk_p_r_id

		)
		SELECT
		cd.*
		FROM(
		<foreach item="item" index="index" collection="arrays"
			separator="union all">
			SELECT
			#{item},
			#{fk_p_r_id}
			FROM dual
		</foreach>
		)cd


	</insert>

	<!-- <insert id="allotPolice" parameterType="java.util.Map"> insert into 
		jcsj_p_r_allot <trim prefix="(" suffix=")" suffixOverrides="," > fk_p_r_id, 
		<if test="fk_user_id != null and fk_user_id !=''"> fk_user_id, </if> </trim> 
		<trim prefix="values (" suffix=")" suffixOverrides="," > #{fk_p_r_id}, <if 
		test="fk_user_id != null and fk_user_id !=''"> #{fk_user_id}, </if> </trim> 
		</insert> -->

	<update id="updateResourc" parameterType="java.util.Map">
		update jcsj_police_resources
		<trim prefix="set" suffixOverrides=",">
			<if test="fk_dept_id != null and fk_dept_id !=''">
				fk_dept_id = #{fk_dept_id},
			</if>


			<if test="enable_date != null and enable_date !=''">
				enable_date =to_date(#{enable_date},'yyyy-mm-dd
				HH24:mi:ss'),
			</if>

			<if test="validity_date != null and validity_date !=''">
				validity_date = to_date(#{validity_date},'yyyy-mm-dd
				HH24:mi:ss'),
			</if>

			<if test="car_type != null and car_type !=''">
				car_type = #{car_type},
			</if>

			<if test="car_brand != null and car_brand !=''">
				car_brand = #{car_brand},
			</if>

			<if test="car_num != null and car_num !=''">
				car_num = #{car_num},
			</if>

			<if
				test="annual_inspection_valid != null and annual_inspection_valid !=''">
				annual_inspection_valid =
				to_date(#{annual_inspection_valid},'yyyy-mm-dd HH24:mi:ss'),
			</if>

			<if test="insurance_company != null and insurance_company !=''">
				insurance_company = #{insurance_company},
			</if>

			<if test="insurance_num != null and insurance_num !=''">
				insurance_num = #{insurance_num},
			</if>

			<if test="manufacturer != null and manufacturer !=''">
				manufacturer = #{manufacturer},
			</if>

			<if test="sim_num != null and sim_num !=''">
				sim_num = #{sim_num},
			</if>

			<if test="staff_name != null and staff_name !=''">
				staff_name = #{staff_name},
			</if>


			<if test="staff_contacts_num != null and staff_contacts_num !=''">
				staff_contacts_num = #{staff_contacts_num},
			</if>

			<if test="call_num != null and call_num !=''">
				call_num = #{call_num},
			</if>

			<if test="device_model != null and device_model !=''">
				device_model = #{device_model},
			</if>

			<if test="device_type != null and device_type !=''">
				device_type = #{device_type},
			</if>

			<if test="create_person != null and create_person !=''">
				create_person = #{create_person},
			</if>


			<if test="car_purpose != null and car_purpose !=''">
				car_purpose = #{car_purpose},
			</if>
		</trim>
		where pk_id = #{pk_id,jdbcType=DECIMAL}
	</update>

	<!-- <update id="updatePolicce" parameterType="java.util.Map"> <foreach 
		collection="array" item="item" index="index" open="begin" close=";end;" separator=";"> 
		update jcsj_p_r_allot <set> fk_user_id=#{item} </set> where fk_p_r_id = #{fk_p_r_id,jdbcType=DECIMAL} 
		</foreach> update jcsj_p_r_allot <trim prefix="set" suffixOverrides=","> 
		<trim prefix="fk_user_id" suffix="end,"> <foreach collection="array" item="cus"> 
		<if test="fk_user_id!=null"> when fk_p_r_id=#{fk_p_r_id} then #{cus.fk_user_id} 
		</if> </foreach> </trim> </trim> where fk_p_r_id=#{fk_p_r_id} </update> -->


	<!-- <update id="updateHave" parameterType="java.util.Map"> update jcsj_p_r_have_function 
		<set> <if test="fk_have_function != null and fk_have_function !=''"> fk_have_function 
		= #{fk_have_function}, </if> </set> where fk_p_r_id = #{fk_p_r_id,jdbcType=DECIMAL} 
		</update> -->

	<delete id="deletePersonAll" parameterType="java.util.Map">
		delete FROM jcsj_police_resources
		WHERE pk_id in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<delete id="deletePoliceList" parameterType="java.util.Map">
		delete FROM jcsj_p_r_allot
		WHERE
		fk_p_r_id in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<delete id="deleteHaveList" parameterType="java.util.Map">

		delete FROM jcsj_p_r_have_function
		WHERE fk_p_r_id in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>
	<!-- 删除警车关联GPS信息 -->
	<delete id="deleteGpsList" parameterType="java.util.Map">

		delete FROM JCSJ_P_R_RELATION
		WHERE FK_P_R_ID in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<!-- 删除GPS关联警车信息 -->
	<delete id="deleteCarList" parameterType="java.util.Map">

		delete FROM JCSJ_P_R_RELATION
		WHERE FK_GPS_ID in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<!-- 删除民警 辅警信息 -->
	<delete id="deleteMJ" parameterType="java.util.Map">
		delete FROM JCSJ_POLICE_RES_PERSON
		WHERE
		ID in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<delete id="deleteResourc" parameterType="java.util.Map">

		delete FROM
		jcsj_police_resources
		WHERE pk_id=#{pk_id}
	</delete>
	<delete id="deletePolice" parameterType="java.util.Map">
		delete FROM
		jcsj_p_r_allot
		WHERE
		fk_p_r_id=#{fk_p_r_id}
	</delete>

	<delete id="deleteGps" parameterType="java.util.Map">
		delete FROM
		JCSJ_P_R_RELATION
		WHERE
		fk_p_r_id=#{fk_p_r_id}
	</delete>

	<delete id="deleteCarByGps" parameterType="java.util.Map">
		delete FROM
		JCSJ_P_R_RELATION
		WHERE
		fk_gps_id=#{fk_p_r_id}
	</delete>

	<delete id="deleteHave" parameterType="java.util.Map">

		delete FROM
		jcsj_p_r_have_function
		WHERE fk_p_r_id=#{fk_p_r_id}
	</delete>

	<select id="deptTree"
		resultType="com.cist.policemngment.model.Depart_info"
		parameterType="java.lang.Integer">
		select t.dept_pk,t.dept_code,t.dept_name as
		name,t.DEPT_SUPERIOR,'false' flag from
		sys_depart_info t
		<where>
			<if test="_parameter  == null or _parameter  == ''">
				t.DEPT_SUPERIOR is null
			</if>
			<if test="_parameter  != null and _parameter  != ''">
				t.DEPT_SUPERIOR=#{_parameter}
			</if>
		</where>
	</select>
	<!-- 查询所有GPS信息并按部门分组 -->
	<!-- <select id="selectGps" resultType="com.cist.policemngment.model.Depart_info" 
		parameterType="java.lang.Integer"> select t.device_type name ,t.pk_id dept_pk,'true' 
		flag from JCSJ_POLICE_RESOURCES t where t.resources_type =2 and t.fk_dept_id=#{_parameter} 
		and t.pk_id not in(select t1.fk_gps_id from JCSJ_P_R_RELATION t1) </select> -->
	<!-- 查询所有GPS信息并按部门分组 -->
	<select id="selectGps"
		resultType="com.cist.policemngment.model.DeptDeviceTree"
		parameterType="java.lang.Long">
		select t.device_type title ,t.pk_id key,'true' flag
		from
		JCSJ_POLICE_RESOURCES t
		where t.resources_type =2 and
		t.fk_dept_id=#{_parameter}
		and t.pk_id not in(select t1.fk_gps_id from
		JCSJ_P_R_RELATION t1)
	</select>




	<!-- 查询所有警车信息并按部门分组 -->
	<select id="selectPoliceCarAll"
		resultType="com.cist.policemngment.model.Depart_info"
		parameterType="java.lang.Integer">
		select t.car_num name,t.pk_id dept_pk,'true' flag from
		JCSJ_POLICE_RESOURCES t
		where t.resources_type in(1,5,6) and
		t.fk_dept_id=#{_parameter}
	</select>

	<!-- 查询所有GPS信息并按部门分组 -->
	<select id="selectGpsAll"
		resultType="com.cist.policemngment.model.Depart_info"
		parameterType="java.lang.Integer">
		select t.device_type name,t.pk_id dept_pk,'true' flag
		from
		JCSJ_POLICE_RESOURCES t
		where t.resources_type =2 and
		t.fk_dept_id=#{_parameter}
	</select>

	<!-- 查询选中的gps或者警车 -->
	<select id="selectCheck"
		resultType="com.cist.policemngment.model.Jcsj_P_R_Relation"
		parameterType="java.util.HashMap">
		select * from
		JCSJ_P_R_RELATION t
		<where>
			<if test="fk_p_r_id != null and fk_p_r_id != '' ">
				and FK_P_R_ID =#{fk_p_r_id}
			</if>
			<if test="fk_gps_id != null and fk_gps_id != '' ">
				and fk_gps_id =#{fk_gps_id}
			</if>
		</where>
	</select>

	<!-- 查询选中的gps或者警车 -->
	<select id="selectDataCheck"
		resultType="com.cist.policemngment.model.Jcsj_P_R_Relation"
		parameterType="java.util.HashMap">
		select * from
		JCSJ_P_R_RELATION t
		<where>
			<if test="car_id != null and car_id != '' ">
				and FK_P_R_ID =#{car_id}
			</if>
			<if test="gps_id != null and gps_id != '' ">
				and fk_gps_id =#{gps_id}
			</if>
			<if test="flagCarPk != null and flagCarPk != '' ">
				and fk_p_r_id !=#{flagCarPk}
			</if>
			<if test="flagGpsPk != null and flagGpsPk != '' ">
				and fk_gps_id !=#{flagGpsPk}
			</if>
		</where>
	</select>
	<!-- 删除人员 民警和辅助 -->
	<delete id="deletePerson" parameterType="java.util.Map">
		delete FROM JCSJ_POLICE_RES_PERSON
		WHERE ID in
		<foreach item="pk" collection="pkList" open="(" separator=","
			close=")">
			#{pk}
		</foreach>
	</delete>

	<!-- 查询人员编号是否唯一 -->
	<select id="selectPoliceCode" parameterType="java.util.Map"
		resultType="com.cist.policemngment.model.Jcsj_Police_Res_Person">
		select rybh,sfzhm from JCSJ_POLICE_RES_PERSON

		where
		rybh=#{rybh}
		<if test="id !=null and id != ''">
			and id !=#{id}
		</if>
	</select>

	<!-- 查询人员编号是否唯一 -->
	<select id="selectSfzhm" parameterType="java.util.Map"
		resultType="com.cist.policemngment.model.Jcsj_Police_Res_Person">
		select sfzhm from JCSJ_POLICE_RES_PERSON
		where
		sfzhm=#{sfzhm}
		<if test="id !=null and id != ''">
			and id !=#{id}
		</if>
	</select>

	<!-- 查询设备编号是否唯一 -->
	<select id="selectDeviceCode" parameterType="java.util.Map"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc">
		select DEVICE_CODE from JCSJ_POLICE_RESOURCES
		<where>

			<if test="device_code !=null and device_code != ''">
				and DEVICE_CODE=#{device_code}
			</if>
			<if test="car_num !=null and car_num != ''">
				and car_num =#{car_num}
			</if>
			<if test="pk_id !=null and pk_id != ''">
				and pk_id !=#{pk_id}
			</if>
		</where>
	</select>



	<!-- 警务通和350M查询 -->
	<select id="selectByJW"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc"
		parameterType="java.util.Map">

		select * from VW_JCSJ_RESOURCES_SERVICE t

		<where>
			<if test="fk_dept_id != null and fk_dept_id !=''">
				and t.fk_dept_id =#{fk_dept_id}
			</if>
			<if test="xm != null and xm !=''">
				and t.xm like '%'||#{xm}||'%'
			</if>
			<if test="device_type != null and device_type !=''">
				and t.device_type like '%'||#{device_type}||'%'
			</if>
			<if test="sim_num != null and sim_num !=''">
				and t.sim_num like '%'||#{sim_num}||'%'
			</if>
			<if test="call_num != null and call_num !=''">
				and t.call_num like '%'||#{call_num}||'%'
			</if>
			and t.resources_type = #{resources_type}
		</where>
	</select>


	<!-- 查询GPS信息和相关车辆信息 -->
	<select id="selectByGpsCar"
		resultType="com.cist.policemngment.model.Jcsj_police_resourc"
		parameterType="java.util.Map">
		select * from VW_JCSJ_GPS_CAR t
		<where>
			<if test="fk_dept_id != null and fk_dept_id !=''">
				and t.fk_dept_id =#{fk_dept_id}
			</if>
			<if test="car_num != null and car_num !=''">
				and t.hphm like '%'||#{car_num}||'%'
			</if>
			<if test="sim_num != null and sim_num !=''">
				and t.sim_num like '%'||#{sim_num}||'%'
			</if>
			<if test="device_code != null and device_code !=''">
				and t.device_code like '%'||#{device_code}||'%'
			</if>
			and t.resources_type = #{resources_type}
		</where>
	</select>
	<select id="queryTopLevelDept"
		resultType="com.cist.policemngment.model.DeptDeviceTree">
		select dept_pk pk,dept_code key ,dept_name title from
		sys_depart_info where
		dept_superior is null

	</select>
	<select id="querySubLevelDept" parameterType="java.lang.Long"
		resultType="com.cist.policemngment.model.DeptDeviceTree">
		select dept_pk pk,dept_code key ,dept_name title from
		sys_depart_info where
		dept_superior=#{deptId}

	</select>

	<!-- 根据部门Id查询管理的设备中具有视频功能的设备类型List -->
	<select id="queryDeviceType"
		resultType="com.cist.policemngment.model.DeptDeviceTree"
		parameterType="java.lang.String">


		select
		d.fk_dept_id,d.fk_device_type,d.fk_dept_id||'-'||d.fk_device_type
		key,

		(select f.fc_name name from SYS_FRM_CODE f join SYS_FRM_CODE_TYPE t on
		f.FCT_CODE=t.FCT_CODE where t.FCT_CODE='M001' and f.fc_code=
		d.fk_device_type) title


		from Jcsj_device d where d.fk_device_type not
		in('KK','QJCS') and (d.pk_id
		in(
		select f.device_id from
		JCSJ_DEVICE_HAVE_FUNCTION f where f.FK_HAVE_FUNCTION
		=(select f.fc_pk
		pk from
		SYS_FRM_CODE f join SYS_FRM_CODE_TYPE t on
		f.FCT_CODE=t.FCT_CODE where
		t.FCT_CODE='G999' and f.fc_code='SP')) or
		d.fk_device_type = 'JK' )
		and d.fk_dept_id=#{deptId}

		group by
		d.fk_dept_id,d.fk_device_type

	</select>

	<select id="queryVideoDevice"
		resultType="com.cist.policemngment.model.DeptDeviceTree"
		parameterType="java.util.HashMap">
		SELECT
		<!-- DECODE(b.status,0,d.device_name||'(离线)',1,d.device_name||'(在线)',null,d.device_name||'(离线)') -->
		d.device_name
		title, nvl(b.status,0) status,
		d.device_num
		key,d.longitude,d.latitude,g.device_gb_serial,
		g.device_gb_code,g.device_gb_channel,g.device_gb_ptz,d.direction,d.fk_device_type
		FROM
		(SELECT
		d.pk_id,d.device_name,fk_device_type,d.fk_dept_id,d.longitude,d.latitude,d.device_num,d.direction
		FROM
		JCSJ_DEVICE d WHERE
		d.fk_device_type not in('KK','QJCS') AND
		(d.pk_id
		IN(
		SELECT f.device_id FROM
		JCSJ_DEVICE_HAVE_FUNCTION f WHERE
		f.FK_HAVE_FUNCTION
		=(SELECT f.fc_pk
		pk from
		SYS_FRM_CODE f JOIN
		SYS_FRM_CODE_TYPE t ON
		f.FCT_CODE=t.FCT_CODE WHERE
		t.FCT_CODE='G999' AND
		f.fc_code='SP')) OR
		d.fk_device_type = 'JK' ) and
		d.fk_dept_id=#{dept_id}
		AND d.fk_device_type=#{device_type_code})
		d
		LEFT
		JOIN JCSJ_DEVICE_CAMERA_GB28181 g ON g.device_id=d.pk_id

		LEFT JOIN
		JCSJ_DEVICE_STATUS_BASIC b ON b.fk_device_id=d.pk_id

	</select>
	<!-- 查询所有警车信息并按部门分组 -->
	<!-- <select id="selectPoliceCar" resultType="com.cist.policemngment.model.Depart_info" 
		parameterType="java.lang.Integer"> select t.car_num name,t.pk_id dept_pk,'true' 
		flag from JCSJ_POLICE_RESOURCES t where t.resources_type in(1,5,6) and t.fk_dept_id=#{_parameter} 
		and t.pk_id not in(select t1.fk_p_r_id from JCSJ_P_R_RELATION t1) </select> -->
	<select id="selectPoliceCar"
		resultType="com.cist.policemngment.model.DeptDeviceTree"
		parameterType="java.lang.Long">
		select
		decode(t.resources_type,'1','警车','5','摩托车','6','电瓶车')
		title,t.fk_dept_id||'-'||t.resources_type key,'true' flag from
		JCSJ_POLICE_RESOURCES t
		where t.resources_type in(1,5,6) and
		t.fk_dept_id=#{_parameter}

		and t.pk_id not in(select t1.fk_p_r_id from
		JCSJ_P_R_RELATION t1)
		group by t.fk_dept_id,t.resources_type
	</select>

	<select id="selectPoliceCarNum"
		resultType="com.cist.policemngment.model.DeptDeviceTree"
		parameterType="java.lang.Long">
		select t.car_num title,t.pk_id key,'true' flag from
		JCSJ_POLICE_RESOURCES t
		where t.resources_type in(1,5,6) and
		t.fk_dept_id=#{_parameter}
		and t.pk_id not in(select t1.fk_p_r_id from
		JCSJ_P_R_RELATION t1)
	</select>

	<select id="selectBaseDate"
		resultType="com.cist.policemngment.model.Sys_frm_code"
		parameterType="java.util.HashMap">
		select fc_pk,fc_code value,fc_name label,fc_num from SYS_FRM_CODE
		where
		FCT_CODE=#{fct_code}
		<if test="fc_num != null and fc_num != ''">
			and fc_num=#{fc_num}
		</if>
		<if test="fc_pk != null and fc_pk != ''">
			and fc_num=#{fc_pk}
		</if>
	</select>
</mapper>
	