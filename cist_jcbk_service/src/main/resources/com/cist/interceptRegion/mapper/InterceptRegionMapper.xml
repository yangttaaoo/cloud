<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="com.cist.interceptRegion.mapper.InterceptRegionMapper">
	<!-- 根据查询顶级部门 -->
	<select id="queryTopLevelDept"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select dept_pk pk,dept_code key ,dept_name
		title,geo_spatial from sys_depart_info where
		dept_superior is null

	</select>
	<!-- 根据部门Id查询子部门 -->
	<select id="querySubLevelDept" parameterType="java.lang.Long"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select dept_pk pk,dept_code key ,dept_name
		title,geo_spatial from sys_depart_info where
		dept_superior=#{deptId}

	</select>
	<!-- 查询拦截区域List -->
	<select id="queryAreaList" parameterType="java.util.HashMap"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select a.pk key,a.qymc title, a.PK pk_id,a.qymc,a.QYXX
		,a.GLBM,a.CJR,a.CJSJ,a.QYZT from JCBK_FENCE_AREA a where 1=1
		<if test="area_name !=null and area_name !=''">
			and a.qymc like '%'||#{area_name}||'%'
		</if>

	</select>
	<!-- 根据查询顶级巡区 -->
	<select id="queryTopLevelArea" parameterType="java.util.HashMap"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select b.name area_type_name,c.dept_name fk_dept_name,
		a.*,a.pk_id key,a.area_name title from qw_patrol_area a left join
		(select f.fc_pk pk,f.fc_code code,f.fc_name name from SYS_FRM_CODE f
		join SYS_FRM_CODE_TYPE t on f.FCT_CODE=t.FCT_CODE where
		t.FCT_CODE='QW02' order by f.FC_NUM )
		b on a.area_type=b.code left join sys_depart_info c on
		c.dept_code=a.fk_dept_id

		where a.fk_dept_id=#{deptId} and a.parent_area is null

	</select>
	<!-- 根据部门编码查询拦截区域 -->
	<select id="queryInterceptRegionByDept"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select a.pk
		key,a.qymc title,a.PK pk_id,a.qymc,a.QYXX ,a.GLBM,a.CJR,a.CJSJ,a.QYZT
		from JCBK_FENCE_AREA a where a.glbm=#{deptId}
	</select>
	<!-- 根据巡区Id查询子巡区 -->
	<select id="querySubLevelArea" parameterType="java.util.HashMap"
		resultType="com.cist.interceptRegion.model.FenceArea">
		select b.name area_type_name,c.dept_name fk_dept_name,
		a.*,a.pk_id
		key,a.area_name title from qw_patrol_area a left join
		(select f.fc_pk pk,f.fc_code code,f.fc_name name from SYS_FRM_CODE f
		join
		SYS_FRM_CODE_TYPE t on f.FCT_CODE=t.FCT_CODE where
		t.FCT_CODE='QW02'
		order by f.FC_NUM )
		b on a.area_type=b.code left join
		sys_depart_info c on
		c.dept_code=a.fk_dept_id

		where
		a.fk_dept_id=#{deptId} and a.parent_area=#{areaId}

	</select>
	<!-- 根据数据字典索引查询对应信息 -->
	<select id="queryBaseDateByFct_Code"
		resultType="com.cist.interceptRegion.model.TempModel">
		select f.fc_pk pk,f.fc_code code,f.fc_name name from
		SYS_FRM_CODE f join
		SYS_FRM_CODE_TYPE t on f.FCT_CODE=t.FCT_CODE where
		t.FCT_CODE=#{FCT_CODE} order by f.FC_NUM
	</select>
	<!-- 新增拦截区域 -->
	<insert id="insertArea" parameterType="java.util.HashMap">
		insert into
		JCBK_FENCE_AREA(pk,qymc,qyxx,glbm,cjr,cjsj,qyzt)
		values(seq_jcbk_fence_area.nextval,#{qymc},#{qyxx},
		#{glbm},#{cjr},SYSDATE,#{qyzt})
	</insert>
	<!-- 更新拦截区域 -->
	<update id="updateArea" parameterType="java.util.HashMap">
		update JCBK_FENCE_AREA set
		qymc=#{qymc},
		qyxx=#{qyxx}, glbm=#{glbm}, qyzt=#{qyzt} where
		pk=#{pk_id}
	</update>
	<!-- 删除拦截区域 -->
	<delete id="deleteArea" parameterType="java.util.HashMap">

		delete from JCBK_FENCE_AREA where pk in
		<foreach collection="areaIds" index="index" item="pk_id"
			open="(" close=")" separator=",">
			#{pk_id}
		</foreach>
	</delete>
	<!-- 导入拦截区域 QYZT 区域状态，0-禁用 1-启用 -->
	<insert id="importInterceptRegion" useGeneratedKeys="false"
		parameterType="java.util.HashMap">
		begin
		<foreach collection="interceptRegion" item="region"
			index="index" separator=";">
			insert into
			JCBK_FENCE_AREA(pk,qymc,qyxx,glbm,cjr,cjsj,qyzt)
			values(seq_jcbk_fence_area.nextval,#{region.qymc},
			#{region.qyxx,jdbcType=CLOB},#{region.glbm},#{region.cjr}
			,SYSDATE,'1' )
		</foreach>
		;end;
	</insert>
</mapper>